import { v4 } from 'uuid'
import { describe, expect, it } from 'vitest'
import MiniSearch from 'minisearch'

const notes = [
  {
    id: v4(),
    content: `東京は日本の首都であり、世界で最も人口の多い大都市です。超高層ビルが立ち並ぶ都会的な景観と、伝統的な寺社仏閣が調和した、多様な魅力を持つ街です。流行の発信地であると同時に、豊かな自然も有しており、様々な顔を持つ都市です。`
  },
  {
    id: v4(),
    content: `大阪は、日本の主要都市の1つで、関西地方の中心的な役割を担っています。道頓堀に代表される活気ある市街地を持ち、たこ焼きやお好み焼きなどの名物料理が豊富な「食い倒れの街」としても知られています。また、大阪城をはじめとする歴史的な観光スポットも有しており、国内外からの観光客に人気の都市です。`
  },
  {
    id: v4(),
    content: `福岡は、九州地方最大の都市であり、政治・経済・文化の中心地として発展してきました。博多ラーメンやもつ鍋などのご当地グルメが有名で、食の都としても知られています。また、歴史的な寺社や自然豊かな公園も多く、都会と自然が調和した魅力的な都市です。`
  },
  {
    id: v4(),
    content: `札幌は、北海道最大の都市であり、四季折々の美しい自然と都市機能が調和した街です。大通公園や札幌テレビ塔などの観光スポットがあり、冬には雪まつりが開催されることでも有名です。また、味噌ラーメンやジンギスカンなどの北海道ならではのグルメも楽しめます。`
  },
  {
    id: v4(),
    content: `名古屋は、日本の主要都市の1つで、中京圏の中心都市として発展してきました。名古屋城や熱田神宮などの歴史的な観光スポットがあり、味噌カツや手羽先などのご当地グルメも豊富です。また、自動車産業が盛んで、日本のものづくりを支える重要な都市でもあります。`
  },
  {
    id: v4(),
    content: `神戸は、兵庫県の県庁所在地であり、国際的な港湾都市として発展してきました。異人館やメリケンパークなどの観光スポットがあり、おしゃれな街並みが特徴です。また、神戸牛やスイーツなど、グルメも充実しており、国内外からの観光客に人気の都市です。`
  },
  {
    id: v4(),
    content: `京都は、日本の古都であり、数多くの寺社仏閣や文化財を有する歴史的な都市です。清水寺や金閣寺などの有名な観光スポットがあり、伝統的な文化や景観が今もなお残っています。また、京料理や抹茶など、京都ならではの食文化も楽しめます。`
  },
  {
    id: v4(),
    content: `横浜は、神奈川県の県庁所在地であり、日本の開港5都市の1つとして、早くから国際的な交流が盛んな都市です。横浜中華街や赤レンガ倉庫などの観光スポットがあり、異国情緒あふれる街並みが特徴です。また、みなとみらい21地区には、高層ビルや商業施設が集まり、近代的な都市景観も楽しめます。`
  },
  {
    id: v4(),
    content: `広島は、中国地方最大の都市であり、平和記念都市として世界的に知られています。原爆ドームや平和記念資料館などの平和関連施設があり、核兵器廃絶と平和を求めるメッセージを発信しています。また、広島風お好み焼きや牡蠣など、ご当地グルメも豊富です。`
  },
  {
    id: v4(),
    content: `仙台は、東北地方最大の都市であり、「杜の都」として知られています。豊かな自然に囲まれ、美しい公園や並木道が多く、四季折々の風景が楽しめます。また、伊達政宗ゆかりの地であり、歴史的な史跡や文化財も数多く残っています。`
  },
  {
    id: v4(),
    content: `金沢は、石川県の県庁所在地であり、加賀百万石の城下町として栄えました。兼六園や金沢城などの歴史的な観光スポットがあり、伝統的な文化や街並みが今もなお残っています。また、新鮮な海の幸や加賀料理など、食文化も豊かな都市です。`
  },
  {
    id: v4(),
    content: `浜松は、静岡県の西部にある都市で、豊かな自然と温暖な気候が特徴です。浜名湖や中田島砂丘などの景勝地があり、マリンスポーツやレジャーも楽しめます。また、ヤマハやローランドなど、楽器メーカーの本社が多く、音楽の街としても知られています。`
  },
  {
    id: v4(),
    content: `熊本は、熊本県の県庁所在地であり、雄大な熊本城を中心に発展してきました。阿蘇山をはじめとする豊かな自然に囲まれ、美しい景観が楽しめます。また、熊本ラーメンや馬刺しなど、ご当地グルメも豊富です。`
  },
  {
    id: v4(),
    content: `長崎は、長崎県の県庁所在地であり、日本の開港5都市の1つとして、古くから海外との交流が盛んな都市です。平和公園やグラバー園などの観光スポットがあり、異国情緒あふれる街並みが特徴です。また、長崎ちゃんぽんやカステラなど、独自の食文化も育まれてきました。`
  },
  {
    id: v4(),
    content: `北九州は、九州地方の最北端に位置し、関門海峡を挟んで本州と向かい合う都市です。工業地帯として発展し、日本の近代化を支えてきました。近年は、環境問題に積極的に取り組み、自然と共存する都市づくりを目指しています。`
  },
  {
    id: v4(),
    content: `奈良は、日本の古都であり、数多くの寺社仏閣や文化財を有する歴史的な都市です。奈良公園には、野生の鹿が多数生息しており、観光客に人気です。また、東大寺の大仏や春日大社の万灯籠など、見どころも豊富です。`
  },
  {
    id: v4(),
    content: `千葉は、千葉県の県庁所在地であり、東京湾に面した臨海都市です。幕張メッセや東京ディズニーリゾートなどの大規模な施設があり、国内外からの観光客に人気です。また、千葉市動物公園や稲毛海浜公園など、自然豊かなスポットも多くあります。`
  },
  {
    id: v4(),
    content: `岡山は、中国地方の中心都市であり、瀬戸内海の温暖な気候に恵まれています。後楽園や岡山城などの観光スポットがあり、歴史的な文化や景観が今もなお残っています。また、マスカットや桃など、特産品も豊富です。`
  },
  {
    id: v4(),
    content: `埼玉は、東京都に隣接する県であり、都心へのアクセスが良いベッドタウンとして発展してきました。鉄道博物館や埼玉県立自然史博物館などの文化施設があり、子供から大人まで楽しめます。また、秩父山地や川越など、自然豊かな観光スポットも多くあります。`
  },
  {
    id: v4(),
    content: `川崎は、神奈川県北東部に位置し、東京都と横浜市に挟まれた工業都市です。京浜工業地帯の中核を担い、日本の経済発展を支えてきました。近年は、再開発が進み、商業施設や文化施設も充実しています。`
  },
  {
    id: v4(),
    content: `堺は、大阪府の南部に位置し、歴史と文化が豊かな都市です。中世には自由都市として栄え、商工業が発展しました。現在も、伝統産業である刃物や線香の製造が盛んです。`
  },
  {
    id: v4(),
    content: `新潟は、新潟県の県庁所在地であり、米どころとして知られています。日本海に面し、新鮮な魚介類も豊富です。また、豪雪地帯であり、冬には雪景色が美しい街です。`
  },
  {
    id: v4(),
    content: `大分は、大分県の県庁所在地であり、温泉地として有名です。別府温泉や湯布院温泉など、数多くの温泉地があり、観光客に人気です。また、豊かな自然に囲まれ、美しい景観も楽しめます。`
  },
  {
    id: v4(),
    content: `高崎は、群馬県の県庁所在地であり、交通の要衝として発展してきました。だるまの生産地として知られ、高崎だるまは縁起物として親しまれています。また、榛名山や赤城山など、自然豊かな観光スポットも多くあります。`
  },
  {
    id: v4(),
    content: `宇都宮は、栃木県の県庁所在地であり、餃子の街として知られています。宇都宮餃子は、全国的に人気があり、多くの店で味わうことができます。また、二荒山神社や大谷資料館など、観光スポットも点在しています。`
  },
  {
    id: v4(),
    content: `鹿児島は、鹿児島県の県庁所在地であり、南九州の中心都市です。桜島という活火山があり、雄大な自然景観が楽しめます。また、西郷隆盛ゆかりの地であり、歴史的な史跡も数多く残っています。`
  },
  {
    id: v4(),
    content: `福島は、福島県の県庁所在地であり、豊かな自然に囲まれた都市です。飯坂温泉や磐梯山など、観光スポットも多くあります。2011年の東日本大震災からの復興を目指し、現在も復興が進められています。`
  },
  {
    id: v4(),
    content: `宮崎は、宮崎県の県庁所在地であり、温暖な気候と豊かな自然が特徴です。日向灘に面し、美しい海岸線やサーフスポットが数多くあります。また、宮崎牛や地鶏など、特産品も豊富です。`
  },
  {
    id: v4(),
    content: `秋田は、秋田県の県庁所在地であり、豊かな自然と歴史的な文化が魅力です。冬には雪が多く、かまくらや雪まつりなどのイベントが開催されます。また、秋田犬やきりたんぽなど、特産品も豊富です。`
  },
  {
    id: v4(),
    content: `富山は、富山県の県庁所在地であり、立山連峰を望む美しい景観が特徴です。富山湾は、新鮮な魚介類の宝庫であり、寿司や白エビなど、ご当地グルメも豊富です。また、薬の生産地としても知られています。`
  },
]

const segmenterJa = new Intl.Segmenter('ja', { granularity: 'word' })

const miniSearch = new MiniSearch({
  fields: ['content'],
  storeFields: ['content'],
  tokenize: (content) => Array.from(segmenterJa.segment(content), ({ segment }) => segment).filter(s => s.trim())
})

miniSearch.addAll(notes)

describe('search', () => {
  it('', () => {
    const results = miniSearch.search('ラーメン')
    expect(results.length).toBe(3)
  })
  it('', () => {
    const results = miniSearch.search('ラーーメン')
    expect(results.length).toBe(0)
  })
  it('', () => {
    const results = miniSearch.search('ラーーメン', { fuzzy: 0.1 })
    expect(results.length).toBe(3)
  })
  it('', () => {
    const results = miniSearch.search('都市')
    expect(results.length).toBe(21)
  })
  it('', () => {
    const results = miniSearch.search('自然')
    expect(results.length).toBe(15)
  })
  it('', () => {
    const results = miniSearch.search('テレビ')
    expect(results.length).toBe(0)
  })
  it('', () => {
    const results = miniSearch.search('テレビ', { prefix: true })
    expect(results.length).toBe(1)
  })
  it('', () => {
    const results = miniSearch.search('たこ焼き')
    expect(results.length).toBe(1)
  })
  it('', () => {
    const results = miniSearch.search('雪')
    expect(results.length).toBe(2)
  })
  it('', () => {
    const results = miniSearch.search('山', { fuzzy: 0.4 })
    expect(results.length).toBe(0)
  })
  it('', () => {
    const results = miniSearch.search('山', { fuzzy: 0.5 })
    expect(results.length).toBe(30)
  })
  it('', () => {
    const results = miniSearch.search('海')
    expect(results.length).toBe(2)
  })
  it('', () => {
    const results = miniSearch.search('海', { fuzzy: 0.4 })
    expect(results.length).toBe(2)
  })
  it('', () => {
    const json = miniSearch.toJSON()
    expect(json.documentCount).toBe(30)
    expect(json.index.length).toBeGreaterThan(400)
    expect(json.serializationVersion).toBe(2)
  })
})
